<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Corridas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --orange: #ff6f00;
      --orange-dark: #e65100;
      --black: #121212;
      --white: #fff;
      --bg: #f5f5f5;
      --radius: 10px;
      --shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--black);
    }

    header {
      background: var(--black);
      color: var(--white);
      padding: 20px;
      text-align: center;
      font-size: 1.5em;
    }

    main {
      max-width: 700px;
      margin: 30px auto;
      padding: 0 20px;
    }

    form, .projecao, table {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 30px;
    }

    form label, .projecao label {
      display: block;
      margin: 12px 0 5px;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-size: 1em;
      margin-bottom: 15px;
    }

    input[type="date"] {
      background: #fffbea;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .btn {
      display: inline-block;
      background: var(--orange);
      color: var(--white);
      border: none;
      padding: 14px;
      border-radius: var(--radius);
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
    }

    .btn:hover {
      background: var(--orange-dark);
    }

    .btn.secondary {
      background: var(--black);
    }

    .btn.secondary:hover {
      background: #000;
    }

    .cards {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1 1 calc(33% - 10px);
      background: var(--white);
      border-left: 6px solid var(--orange);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      text-align: center;
    }

    .card h4 {
      margin: 0 0 8px;
    }

    .card span {
      font-size: 1.4em;
      font-weight: bold;
      color: var(--orange-dark);
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .projecao h3 {
      margin-top: 0;
    }

    .projecao p {
      margin-top: 10px;
      font-weight: bold;
      color: var(--orange-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background: var(--orange);
      color: var(--white);
    }

    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--black);
      color: var(--white);
      padding: 12px 25px;
      border-radius: 30px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s ease;
      z-index: 9999;
    }

    #toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 600px) {
      .cards {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>ðŸš• Registro de Corridas</header>
  <main>
    <form id="corridaForm">
      <label>DescriÃ§Ã£o:</label>
      <input type="text" id="descricao" required placeholder="Motorista">

      <label>Tipo:</label>
      <select id="tipo" required>
        <option value="ida">Ida</option>
        <option value="volta">Volta</option>
      </select>

      <label>ObservaÃ§Ã£o:</label>
      <textarea id="observacao" placeholder="Detalhes importantes..."></textarea>

      <button type="submit" class="btn">Registrar Corrida</button>
    </form>

    <div class="cards">
      <div class="card"><h4>Total Idas</h4><span id="totalIda">0</span></div>
      <div class="card"><h4>Total Voltas</h4><span id="totalVolta">0</span></div>
      <div class="card"><h4>Total Geral</h4><span id="total">R$ 0,00</span></div>
    </div>

    <div class="actions">
      <button class="btn secondary" onclick="gerarPDF()">Exportar PDF</button>
      <button class="btn secondary" onclick="limparRegistros()">Limpar Registros</button>
    </div>

    <div class="projecao">
      <h3>ðŸ’° ProjeÃ§Ã£o de Pagamento</h3>
      <label>Data Inicial:</label>
      <input type="date" id="dataInicio">
      <label>Data Final:</label>
      <input type="date" id="dataFinal">
      <button class="btn secondary" onclick="calcularProjecao()">Calcular ProjeÃ§Ã£o</button>
      <p id="resultadoProjecao"></p>
    </div>

    <table>
      <thead>
        <tr>
          <th>DescriÃ§Ã£o</th>
          <th>Tipo</th>
          <th>Data</th>
          <th>Valor</th>
        </tr>
      </thead>
      <tbody id="corridasTableBody"></tbody>
    </table>
  </main>

  <div id="toast"></div>

  <script>
    const VALOR_IDA = 10.00;
    const VALOR_VOLTA = 15.00;
    const VALOR_DIA_UTIL = VALOR_IDA + VALOR_VOLTA;

    document.getElementById('corridaForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const descricao = document.getElementById('descricao').value;
      const tipo = document.getElementById('tipo').value;
      const observacao = document.getElementById('observacao').value;
      const dataHora = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
      const valor = tipo === 'ida' ? VALOR_IDA : VALOR_VOLTA;

      let corridas = JSON.parse(localStorage.getItem('corridas')) || [];
      corridas.push({ descricao, tipo, observacao, valor, dataHora });
      localStorage.setItem('corridas', JSON.stringify(corridas));
      atualizar();
      showToast('Corrida registrada!');
      this.reset();
    });

    function atualizar() {
      const corridas = JSON.parse(localStorage.getItem('corridas')) || [];
      document.getElementById('totalIda').innerText = corridas.filter(c => c.tipo === 'ida').length;
      document.getElementById('totalVolta').innerText = corridas.filter(c => c.tipo === 'volta').length;
      document.getElementById('total').innerText = 'R$ ' + corridas.reduce((sum, c) => sum + c.valor, 0).toFixed(2).replace('.', ',');

      const tbody = document.getElementById('corridasTableBody');
      tbody.innerHTML = '';
      corridas.forEach(c => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${c.descricao}</td><td>${c.tipo}</td><td>${c.dataHora}</td><td>R$ ${c.valor.toFixed(2).replace('.', ',')}</td>`;
        tbody.appendChild(tr);
      });
    }

    function calcularProjecao() {
      const inicioStr = document.getElementById('dataInicio').value;
      const fimStr = document.getElementById('dataFinal').value;

      if (!inicioStr || !fimStr) {
        showToast('Selecione as datas!');
        return;
      }

      const dataInicio = new Date(inicioStr + 'T00:00:00');
      const dataFim = new Date(fimStr + 'T00:00:00');

      if (dataFim < dataInicio) {
        showToast('Data final deve ser >= inicial.');
        return;
      }

      let diasUteis = 0;
      let diaAtual = new Date(dataInicio);

      while (diaAtual <= dataFim) {
        const dia = diaAtual.getDay();
        if (dia !== 0 && dia !== 6) diasUteis++;
        diaAtual.setDate(diaAtual.getDate() + 1);
      }

      const total = diasUteis * VALOR_DIA_UTIL;

      document.getElementById('resultadoProjecao').innerText =
        `De ${inicioStr} atÃ© ${fimStr} | ${diasUteis} dias Ãºteis | R$ ${total.toFixed(2).replace('.', ',')}`;

      showToast(`ProjeÃ§Ã£o: ${diasUteis} dias Ãºteis â†’ R$ ${total.toFixed(2)}`);
    }

    function limparRegistros() {
      if (confirm('Limpar TODOS os registros?')) {
        localStorage.removeItem('corridas');
        atualizar();
        showToast('Registros apagados!');
      }
    }

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const corridas = JSON.parse(localStorage.getItem('corridas')) || [];
      if (corridas.length === 0) {
        showToast('Sem corridas.');
        return;
      }

      const agora = new Date().toLocaleString('pt-BR');
      const datas = corridas.map(c => new Date(c.dataHora));
      const dataInicio = new Date(Math.min(...datas));
      const dataFim = new Date(Math.max(...datas));

      const totalIdas = corridas.filter(c => c.tipo === 'ida').length;
      const totalVoltas = corridas.filter(c => c.tipo === 'volta').length;
      const totalGeral = corridas.reduce((sum, c) => sum + c.valor, 0);

      doc.setFontSize(16);
      doc.text("RECIBO DE CORRIDAS", 105, 15, null, null, "center");

      doc.setFontSize(10);
      doc.text(`Emitido em: ${agora}`, 14, 25);
      doc.text(`Pagador: Arnaldo de Sousa Lima`, 14, 32);
      doc.text(`CPF: ***.929.0**-77`, 14, 39);
      doc.text(`Forma de pagamento: Pix`, 14, 46);
      doc.text(`Contato: (64) 9 9295-2748`, 14, 53);
      doc.text(`PerÃ­odo: ${dataInicio.toLocaleDateString()} a ${dataFim.toLocaleDateString()}`, 14, 60);

      const rows = corridas.map(c => [
        c.descricao, c.tipo, c.dataHora, `R$ ${c.valor.toFixed(2).replace('.', ',')}`
      ]);

      doc.autoTable({
        startY: 70,
        head: [['DescriÃ§Ã£o', 'Tipo', 'Data', 'Valor']],
        body: rows,
        styles: { fontSize: 8 }
      });

      const finalY = doc.lastAutoTable.finalY + 5;
      doc.text(`Total Idas: ${totalIdas}`, 14, finalY + 5);
      doc.text(`Total Voltas: ${totalVoltas}`, 14, finalY + 10);
      doc.text(`Total Geral: R$ ${totalGeral.toFixed(2).replace('.', ',')}`, 14, finalY + 15);

      doc.text(`Atecseven Tecnologia 2025 - Todos os direitos reservados.`, 14, finalY + 25);

      doc.save("corridas.pdf");
      showToast('PDF gerado!');
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.innerText = msg;
      toast.className = 'show';
      setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
    }

    atualizar();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super App de Corridas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --orange: #ff6f00;
      --orange-dark: #e65100;
      --black: #121212;
      --white: #fff;
      --bg: #f5f5f5;
      --radius: 12px;
      --shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--black); transition: .3s;}
    header { background: var(--black); color: var(--white); padding: 20px; text-align: center; font-size:1.5em; font-weight:700; position:sticky; top:0; z-index:1000;}
    main { max-width:700px; margin:20px auto; padding:0 15px 40px;}
    form, .projecao, table, .observacoes-gerais { background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; margin-bottom: 25px;}
    label { display:block; margin:10px 0 5px; font-weight:600;}
    input, select, textarea { width:100%; padding:12px; border:1px solid #ddd; border-radius: var(--radius); font-size:1em; margin-bottom:15px; box-sizing:border-box;}
    textarea { min-height:80px; resize: vertical;}
    .btn { display:inline-block; background: var(--orange); color: var(--white); border:none; padding:14px; border-radius: var(--radius); font-size:1.1em; cursor:pointer; transition:.3s; width:100%; font-weight:600; margin-top:5px;}
    .btn:hover { background: var(--orange-dark);}
    .btn.secondary { background: var(--black);}
    .btn.secondary:hover { background: #000;}
    .cards { display:flex; flex-wrap:wrap; gap:15px; margin-bottom:25px;}
    .card { flex:1 1 calc(33% - 10px); background: var(--white); border-left:6px solid var(--orange); border-radius: var(--radius); padding:15px; text-align:center; box-shadow: var(--shadow);}
    .card h4 { margin:0 0 8px; color: var(--orange-dark); font-weight:700;}
    .card span { font-size:1.6em; font-weight:700; color: var(--orange);}
    table { width:100%; border-collapse:collapse; font-size:0.9em;}
    th, td { padding:8px; text-align:center; border:1px solid #ddd;}
    th { background: var(--orange); color: var(--white); font-weight:700;}
    .action-btn { padding:4px 8px; border:none; border-radius:6px; cursor:pointer; font-size:0.85em; margin:1px; }
    .edit-btn { background:#1976d2; color:#fff;}
    .delete-btn { background:#d32f2f; color:#fff;}
    #toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background: var(--black); color:#fff; padding:12px 25px; border-radius:30px; opacity:0; pointer-events:none; transition:.4s; z-index:9999; font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,0.4);}
    #toast.show { opacity:1; pointer-events:auto;}
    @media (max-width:600px){ .cards{flex-direction:column;} .card{flex:1 1 100%;} }
  </style>
</head>
<body>
<header>ðŸš• Super Registro de Corridas</header>
<main>
  <form id="corridaForm">
    <input type="hidden" id="editIndex" value="">
    <label for="descricao">DescriÃ§Ã£o:</label>
    <input type="text" id="descricao" required placeholder="Ex: Ida para trabalho">
    <label for="tipo">Tipo:</label>
    <select id="tipo" required>
      <option value="ida">Ida</option>
      <option value="volta">Volta</option>
    </select>
    <label for="observacao">ObservaÃ§Ã£o:</label>
    <textarea id="observacao" placeholder="Detalhes importantes..."></textarea>
    <button type="submit" class="btn">Registrar Corrida</button>
  </form>

  <div class="observacoes-gerais">
    <label for="observacoesGerais">ðŸ“Œ ObservaÃ§Ãµes Gerais:</label>
    <textarea id="observacoesGerais" placeholder="Estas observaÃ§Ãµes aparecerÃ£o no relatÃ³rio..."></textarea>
  </div>

  <div class="cards">
    <div class="card"><h4>Total Idas</h4><span id="totalIda">0</span></div>
    <div class="card"><h4>Total Voltas</h4><span id="totalVolta">0</span></div>
    <div class="card"><h4>Total Geral</h4><span id="total">R$ 0,00</span></div>
  </div>

  <div class="projecao">
    <h3>ðŸ’° ProjeÃ§Ã£o de Pagamento</h3>
    <label for="dataInicio">Data Inicial:</label>
    <input type="date" id="dataInicio">
    <label for="dataFinal">Data Final:</label>
    <input type="date" id="dataFinal">
    <button class="btn secondary" onclick="calcularProjecao()">Calcular ProjeÃ§Ã£o</button>
    <p id="resultadoProjecao" style="min-height:24px;"></p>
  </div>

  <div class="actions">
    <button class="btn secondary" onclick="gerarPDF()">Exportar PDF</button>
    <button class="btn secondary" onclick="limparRegistros()">Limpar Registros</button>
  </div>

  <canvas id="graficoCorridas" style="margin-bottom:25px;"></canvas>

  <table>
    <thead>
      <tr><th>DescriÃ§Ã£o</th><th>Tipo</th><th>ObservaÃ§Ã£o</th><th>Data e Hora</th><th>Valor (R$)</th><th>AÃ§Ãµes</th></tr>
    </thead>
    <tbody id="corridasTableBody"></tbody>
  </table>
</main>
<div id="toast"></div>

<script>
const VALOR_IDA=10.25,VALOR_VOLTA=15.0,VALOR_DIA_UTIL=VALOR_IDA+VALOR_VOLTA;

const showToast=msg=>{
  const t=document.getElementById('toast');
  t.innerText=msg;
  t.classList.add('show');
  clearTimeout(t.timeout);
  t.timeout=setTimeout(()=>t.classList.remove('show'),3000);
};

document.getElementById('corridaForm').addEventListener('submit',e=>{
  e.preventDefault();
  const descricao=document.getElementById('descricao').value.trim();
  const tipo=document.getElementById('tipo').value;
  const observacao=document.getElementById('observacao').value.trim()||'â€”';
  const editIndex=document.getElementById('editIndex').value;

  if(!descricao){ showToast('DescriÃ§Ã£o Ã© obrigatÃ³ria.'); return; }

  let corridas=JSON.parse(localStorage.getItem('corridas'))||[];
  const dataHora=new Date().toLocaleString('pt-BR');
  const valor=tipo==='ida'?VALOR_IDA:VALOR_VOLTA;

  if(editIndex===''){
    corridas.push({descricao,tipo,observacao,valor,dataHora});
    showToast('Corrida registrada com sucesso!');
  } else {
    corridas[editIndex]={...corridas[editIndex],descricao,tipo,observacao,valor};
    document.getElementById('editIndex').value='';
    showToast('Corrida atualizada com sucesso!');
  }

  localStorage.setItem('corridas',JSON.stringify(corridas));
  e.target.reset();
  atualizar();
});

function atualizar(){
  const corridas=JSON.parse(localStorage.getItem('corridas'))||[];
  document.getElementById('totalIda').innerText=corridas.filter(c=>c.tipo==='ida').length;
  document.getElementById('totalVolta').innerText=corridas.filter(c=>c.tipo==='volta').length;
  const totalGeral=corridas.reduce((acc,c)=>acc+c.valor,0);
  document.getElementById('total').innerText='R$ '+totalGeral.toFixed(2).replace('.',',');

  const tbody=document.getElementById('corridasTableBody');
  tbody.innerHTML='';
  corridas.forEach((c,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${c.descricao}</td>
      <td>${c.tipo.charAt(0).toUpperCase()+c.tipo.slice(1)}</td>
      <td>${c.observacao}</td>
      <td>${c.dataHora}</td>
      <td>R$ ${c.valor.toFixed(2).replace('.',',')}</td>
      <td>
        <button class="action-btn edit-btn" onclick="editar(${i})">Editar</button>
        <button class="action-btn delete-btn" onclick="remover(${i})">Excluir</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  atualizarGrafico(corridas);
}

function editar(index){
  const corridas=JSON.parse(localStorage.getItem('corridas'))||[];
  const c=corridas[index];
  document.getElementById('descricao').value=c.descricao;
  document.getElementById('tipo').value=c.tipo;
  document.getElementById('observacao').value=c.observacao;
  document.getElementById('editIndex').value=index;
  showToast('Modo ediÃ§Ã£o ativado!');
}

function remover(index){
  if(confirm('Deseja realmente excluir este registro?')){
    let corridas=JSON.parse(localStorage.getItem('corridas'))||[];
    corridas.splice(index,1);
    localStorage.setItem('corridas',JSON.stringify(corridas));
    atualizar();
    showToast('Registro removido!');
  }
}

function calcularProjecao(){
  const inicioStr=document.getElementById('dataInicio').value;
  const fimStr=document.getElementById('dataFinal').value;
  if(!inicioStr||!fimStr){ showToast('Selecione as duas datas!'); return; }
  const dataInicio=new Date(inicioStr+'T00:00:00');
  const dataFim=new Date(fimStr+'T00:00:00');
  if(dataFim<dataInicio){ showToast('Data final deve ser maior ou igual Ã  inicial.'); return; }
  let diasUteis=0; let diaAtual=new Date(dataInicio);
  while(diaAtual<=dataFim){ const ds=diaAtual.getDay(); if(ds!==0&&ds!==6)diasUteis++; diaAtual.setDate(diaAtual.getDate()+1); }
  const total=diasUteis*VALOR_DIA_UTIL;
  document.getElementById('resultadoProjecao').innerText=`De ${inicioStr} atÃ© ${fimStr} â†’ ${diasUteis} dias Ãºteis â†’ Valor: R$ ${total.toFixed(2).replace('.',',')}`;
  showToast('ProjeÃ§Ã£o calculada com sucesso!');
}

function limparRegistros(){
  if(confirm('Tem certeza que deseja limpar TODOS os registros?')){
    localStorage.removeItem('corridas');
    atualizar();
    showToast('Registros apagados com sucesso!');
  }
}

async function gerarPDF(){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF();
  const corridas=JSON.parse(localStorage.getItem('corridas'))||[];
  if(corridas.length===0){ showToast('Nenhuma corrida registrada para exportar.'); return; }
  const observacoesGerais=document.getElementById('observacoesGerais').value.trim()||'â€”';
  const agora=new Date().toLocaleString('pt-BR');
  const datas=corridas.map(c=>new Date(c.dataHora));
  const dataInicio=new Date(Math.min(...datas));
  const dataFim=new Date(Math.max(...datas));
  const totalIdas=corridas.filter(c=>c.tipo==='ida').length;
  const totalVoltas=corridas.filter(c=>c.tipo==='volta').length;
  const totalGeral=corridas.reduce((sum,c)=>sum+c.valor,0);
  doc.setFontSize(16); doc.text("RECIBO DE CORRIDAS",105,15,null,null,"center");
  doc.setFontSize(10);
  doc.text(`Emitido em: ${agora}`,14,25);
  doc.text(`Pagador: Arnaldo de Sousa Lima`,14,32);
  doc.text(`CPF: ***.929.0**-77`,14,39);
  doc.text(`Forma de pagamento: Pix`,14,46);
  doc.text(`Contato: (64) 9 9295-2748`,14,53);
  doc.text(`PerÃ­odo: ${dataInicio.toLocaleDateString()} a ${dataFim.toLocaleDateString()}`,14,60);
  doc.text(`ObservaÃ§Ãµes Gerais: ${observacoesGerais}`,14,67);
  const rows=corridas.map(c=>[c.descricao,c.tipo.charAt(0).toUpperCase()+c.tipo.slice(1),c.observacao||'â€”',c.dataHora,`R$ ${c.valor.toFixed(2).replace('.',',')}`]);
  doc.autoTable({startY:75,head:[['DescriÃ§Ã£o','Tipo','ObservaÃ§Ã£o','Data e Hora','Valor']],body:rows,styles:{fontSize:8}});
  const finalY=doc.lastAutoTable.finalY+5;
  doc.text(`Total Idas: ${totalIdas}`,14,finalY+5);
  doc.text(`Total Voltas: ${totalVoltas}`,14,finalY+10);
  doc.text(`Total Geral: R$ ${totalGeral.toFixed(2).replace('.',',')}`,14,finalY+15);
  doc.text(`Atecseven Tecnologia 2025 - Todos os direitos reservados.`,14,finalY+25);
  doc.save("recibo_corridas.pdf");
  showToast('PDF gerado com sucesso!');
}

// GrÃ¡fico
let chartCorridas=null;
function atualizarGrafico(corridas){
  const ctx=document.getElementById('graficoCorridas').getContext('2d');
  const ids=corridas.filter(c=>c.tipo==='ida').length;
  const vols=corridas.filter(c=>c.tipo==='volta').length;
  if(chartCorridas) chartCorridas.destroy();
  chartCorridas=new Chart(ctx,{
    type:'bar',
    data:{ labels:['Idas','Voltas'], datasets:[{label:'Quantidade de Corridas', data:[ids,vols], backgroundColor:['#ff6f00','#e65100']}] },
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });
}

atualizar();
</script>
</body>
</html>

